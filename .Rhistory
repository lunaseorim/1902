a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,rbind(total_trans,
a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,rbind(total_trans,
a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))))
a1
})
system.time(
a1 <- foreach (i=1:183072) %dopar% {
a <- ifelse(is.na(E2[i,40]),
ifelse(is.na(E2[i,39]),
ifelse(is.na(E2[i,38]),
a<-37,a<-38),a<-39),a<-40)
ifelse(a==39,
a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,rbind(total_trans,
a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,rbind(total_trans,
a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))))
a1
})
View(a1)
rm(a1)
system.time(
total_trans <- foreach (i=1:183072,.combine = rbind) %dopar% {
a <- ifelse(is.na(E2[i,40]),
ifelse(is.na(E2[i,39]),
ifelse(is.na(E2[i,38]),
a<-37,a<-38),a<-39),a<-40)
ifelse(a==39,
a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,rbind(total_trans,
a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,rbind(total_trans,
a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))))
a1
})
View(total_trans)
table
table(total_trans$org,total_trans$dst)
table(total_trans$org[1:10],total_trans$dst[1:10])
table(total_trans$org[1:10])
paste0(total_trans$org[1:10],total_trans$dst[1:10])
paste(total_trans$org[1:10],",",total_trans$dst[1:10])
paste0(total_trans$org[1:10],",",total_trans$dst[1:10])
trans_table <- paste0(total_trans$org,",",total_trans$dst)
trans_table<-table(trans_table)
View(total_trans)
trans_table<-data.frame(table(trans_table))
View(total_trans)
View(trans_table)
trans_table<-as.data.frame(table(trans_table))
View(trans_table)
trans_table <- paste0(total_trans$org,",",total_trans$dst)
trans_table<-as.data.frame(table(trans_table))
View(total_trans)
View(trans_table)
View(A2)
View(total_trans)
length(total_trans$org[1])
nchar(total_trans$org[1])
nchar(total_trans$org)
total_trans<-total_trans[nchar(total_trans$org)>4,]
total_trans<-total_trans[,nchar(total_trans$dst)>4]
nchar(total_trans$dst)>4
str(total_trans)
total_trans[178]
total_trans[178,]
total_trans <- foreach (i=1:183072,.combine = rbind) %dopar% {
a <- ifelse(is.na(E2[i,40]),
ifelse(is.na(E2[i,39]),
ifelse(is.na(E2[i,38]),
a<-37,a<-38),a<-39),a<-40)
ifelse(a==39,a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))
a1
})
system.time(
total_trans <- foreach (i=1:183072,.combine = rbind) %dopar% {
a <- ifelse(is.na(E2[i,40]),
ifelse(is.na(E2[i,39]),
ifelse(is.na(E2[i,38]),
a<-37,a<-38),a<-39),a<-40)
ifelse(a==39,a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))
a1
})
ifelse(a==39,a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))
a1
ifelse(a==39,a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))
a
ifelse(a==39,a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48])),NA))
ifelse(a==39,data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)]))),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48]))))
ifelse(a==39,a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)])),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48])))))
View(a1)
a1
system.time(
total_trans <- foreach (i=1:183072,.combine = rbind) %dopar% {
a <- ifelse(is.na(E2[i,40]),
ifelse(is.na(E2[i,39]),
ifelse(is.na(E2[i,38]),
a<-37,a<-38),a<-39),a<-40)
ifelse(a==39,a1<-data.frame(org = as.numeric(E2[i,37:39]),dst = as.numeric(E2[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(E2[i,37:38]),dst = as.numeric(E2[i,c(38,48)])),
ifelse(a==37,a1<-data.frame(org = as.numeric(E2[i,37]),dst = as.numeric(E2[i,48])))))
a1
})
View(a1)
View(total_trans)
any(is.na(total_trans$org))
any(is.na(total_trans$dst))
any(is.na(E2[,48]))
total_trans %>%
na.omit()
total_trans <-total_trans %>%
na.omit()
total_trans<-total_trans[nchar(total_trans$org)>4&nchar(total_trans$dst)>4,]
trans_table <- paste0(total_trans$org,",",total_trans$dst)
trans_table<-as.data.frame(table(trans_table))
View(trans_table)
trans_table <- data.frame(org = substr(trans_table$trans_table,1,7),
trans_table <- data.frame(org = substr(trans_table$trans_table,1,7),
dst = substr(trans_table$trans_table,9,15),
freq = trans_table$Freq)
View(trans_table)
trans_table <- data.frame(org = substr(trans_table$trans_table,1,7),
dst = substr(trans_table$trans_table,9,15),
freq = trans_table$Freq)
View(trans_table)
total_trans<-total_trans[nchar(total_trans$org)>6&nchar(total_trans$dst)>6,]
trans_table <- paste0(total_trans$org,",",total_trans$dst)
trans_table<-as.data.frame(table(trans_table))
trans_table <- data.frame(org = substr(trans_table$trans_table,1,7),
dst = substr(trans_table$trans_table,9,15),
freq = trans_table$Freq)
View(trans_table)
trans_table %>% as_tbl_graph() %>%
mutate(eig=centrality_eigen()) %>%
as_tibble %>%
arrange(desc(eig))
library('tidygraph')
library('ggraph')
install.packages("tidygraph")
install.packages("ggraph")
library(tidygraph)
library(ggraph)
trans_table %>% as_tbl_graph() %>%
mutate(eig=centrality_eigen()) %>%
as_tibble %>%
arrange(desc(eig))
metro %>%
as_tbl_graph()%>%
mutate(eig=centrality_pagerank(weights=freq)) %>%
as_tibble %>%
arrange(desc(eig))
trans_table %>%
as_tbl_graph()%>%
mutate(eig=centrality_pagerank(weights=freq)) %>%
as_tibble %>%
arrange(desc(eig))
system.time(
total_trans <- foreach (i=1:183072,.combine = rbind) %dopar% {
a <- ifelse(is.na(dongtan_tag[i,40]),
ifelse(is.na(dongtan_tag[i,39]),
ifelse(is.na(dongtan_tag[i,38]),
a<-37,a<-38),a<-39),a<-40)
ifelse(a==39,a1<-data.frame(org = as.numeric(dongtan_tag[i,37:39]),dst = as.numeric(dongtan_tag[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(dongtan_tag[i,37:38]),dst = as.numeric(dongtan_tag[i,c(38,48)])),
ifelse(a==37,a1<-data.frame(org = as.numeric(dongtan_tag[i,37]),dst = as.numeric(dongtan_tag[i,48])))))
a1
})
total_trans<-total_trans[nchar(total_trans$org)>6&nchar(total_trans$dst)>6,]
trans_table <- paste0(total_trans$org,",",total_trans$dst)
trans_table<-as.data.frame(table(trans_table))
trans_table <- data.frame(org = substr(trans_table$trans_table,1,7),
dst = substr(trans_table$trans_table,9,15),
freq = trans_table$Freq)
trans_table %>%
as_tbl_graph()%>%
mutate(eig=centrality_pagerank(weights=freq)) %>%
as_tibble %>%
arrange(desc(eig))
View(trans_table)
View(total_trans)
system.time(
total_trans <- foreach (i=1:58150,.combine = rbind) %dopar% {
a <- ifelse(is.na(dongtan_tag[i,40]),
ifelse(is.na(dongtan_tag[i,39]),
ifelse(is.na(dongtan_tag[i,38]),
a<-37,a<-38),a<-39),a<-40)
ifelse(a==39,a1<-data.frame(org = as.numeric(dongtan_tag[i,37:39]),dst = as.numeric(dongtan_tag[i,c(38,39,48)])),
ifelse(a==38,a1<-data.frame(org = as.numeric(dongtan_tag[i,37:38]),dst = as.numeric(dongtan_tag[i,c(38,48)])),
ifelse(a==37,a1<-data.frame(org = as.numeric(dongtan_tag[i,37]),dst = as.numeric(dongtan_tag[i,48])))))
a1
})
total_trans<-total_trans[nchar(total_trans$org)>6&nchar(total_trans$dst)>6,]
trans_table <- paste0(total_trans$org,",",total_trans$dst)
trans_table<-as.data.frame(table(trans_table))
trans_table <- data.frame(org = substr(trans_table$trans_table,1,7),
dst = substr(trans_table$trans_table,9,15),
freq = trans_table$Freq)
trans_table %>%
as_tbl_graph()%>%
mutate(eig=centrality_pagerank(weights=freq)) %>%
as_tibble %>%
arrange(desc(eig))
View(total_trans)
View(trans_table)
View(A2)
trans_table<-trans_table[-13466,]
View(trans_table)
trans_table %>%
as_tbl_graph()%>%
mutate(eig=centrality_pagerank(weights=freq)) %>%
as_tibble %>%
arrange(desc(eig))
View(A2)
#병렬
stopCluster(cl)
desc(trans_table)
order(trans_table$freq)
order(trans_table$freq,decreasing = F)
order(trans_table$freq,decreasing = T)
View(trans_table)
trans_table<-trans_table[order(trans_table$freq,decreasing = T),]
View(trans_table)
trans_table[1]
trans_table[1,]
feat <- as_tbl_graph(total_trans[1:10,])
library(plyr)
library(dplyr)
library(doParallel)
library(tidygraph)
library(ggraph)
feat <- as_tbl_graph(total_trans[1:10,])
plot(feat)
rm(feat)
View(trans_table)
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(tidyverse)
library(mapdeck)
key = "pk.eyJ1IjoibHVuYXNlb3JpbSIsImEiOiJjazJjd3A0Z3IwajAzM2RvMjJvNWdqOGM5In0.C8bch4gbQBoRMccrAeCv8Q"
trans_table_fine1 <- read.csv("data/trans_table_fine1")
AAA <- trans_table_fine1[order(trans_table_fine1$freq,decreasing = T),]
AA <- AAA[1:10,]
rownames(AA)<-1:10
AA$org <- as.factor(AA$org)
AA$dst <- as.factor(AA$dst)
mapdeckplot <- mapdeck( token = key, style = 'mapbox://styles/mapbox/dark-v9', pitch = 45 ) %>%
add_arc(
data = AA
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = "freq"
)
mapdeckplot
View(AA)
str(AA)
url <- 'https://raw.githubusercontent.com/plotly/datasets/master/2011_february_aa_flight_paths.csv'
flights <- read.csv(url)
View(flights)
seq_len(nrow(AA))
AA$id <- seq_len(nrow(AA))
mapdeckplot <- mapdeck( token = key, style = 'mapbox://styles/mapbox/dark-v9', pitch = 45 ) %>%
add_arc(
data = AA
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = "freq"
)
mapdeckplot
flights$stroke <- sample(1:3, size = nrow(flights), replace = T)
View(flights)
AA$stroke <- sample(1:3, size = nrow(AA), replace = T)
mapdeckplot <- mapdeck( token = key, style = 'mapbox://styles/mapbox/dark-v9', pitch = 45 ) %>%
add_arc(
data = AA
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = "stroke"
)
mapdeckplot
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(tidyverse)
library(mapdeck)
key = "pk.eyJ1IjoibHVuYXNlb3JpbSIsImEiOiJjazJjd3A0Z3IwajAzM2RvMjJvNWdqOGM5In0.C8bch4gbQBoRMccrAeCv8Q"
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = flights
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "airport1"
, stroke_to = "airport2"
, stroke_width = "stroke"
, tooltip = "info"
, auto_highlight = TRUE
, legend = T
, legend_options = list(
stroke_from = list( title = "Origin airport" ),
css = "max-height: 100px;")
)
mapdeck( token = key, style = 'mapbox://styles/mapbox/dark-v9', pitch = 45 ) %>%
add_arc(
data = AA
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = "stroke"
)
colnames(AA)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = AA
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = "stroke"
)
class(flights)
class(AA)
colnames(AA)[5]
colnames(AA)[5:7]
colnames(AA)[5:8]
colnames(AA)[5:8]<-c("start_lat","start_lon","end_lat","end_lon")
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = AA
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = "stroke"
)
read.csv(trans_table_fine1,"data/trans_table_fine1")
View(trans_table_fine1)
colnames(trans_table_fine1)[4:7]<-c("start_lat","start_lon","end_lat","end_lon")
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_line(
data = trans_table_fine1
, layer_id = "line_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_colour = "org"
, stroke_width = "freq"
)
View(trans_table_fine1)
trans_table_fine1<-read.csv("../data/trans_table_fine1")
View(trans_table_fine1)
trans_table_fine1<-read.csv("data/trans_table_fine1")
View(trans_table_fine1)
colnames(trans_table_fine1)[5:8]
colnames(trans_table_fine1)[5:8]<-c("start_lat","start_lon","end_lat","end_lon")
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_line(
data = trans_table_fine1
, layer_id = "line_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_colour = "org"
, stroke_width = "freq"
)
order(trans_table_fine1$freq,decreasing = T)
t_t_fine <- trans_table_fine1[order(trans_table_fine1$freq,decreasing = T),]
t_t_fine <- t_t_fine[1:300,]
View(t_t_fine)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_line(
data = t_t_fine
, layer_id = "line_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_colour = "org"
, stroke_width = "freq"
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_line(
data = t_t_fine
, layer_id = "line_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_colour = "org"
, stroke_width = 1
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_line(
data = t_t_fine
, layer_id = "line_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_colour = "org"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_line(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_colour = "org"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = "freq"
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1, legend = T
)
t_t_fine <- t_t_fine[1:100,]
t_t_fine$freq/204
t_t_fine$freq/204+1
t_t_fine$freq<-t_t_fine$freq/204+1
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1, legend = T
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
)
install.packages("arules")
library(arules)
View(trans_table)
View(trans_table_fine1)
View(dongtan_tag)
mean(dongtan_tag$X...총소요시간...)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
)
