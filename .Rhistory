)
trans_alltag_a <- trans_alltag[1:500,]
system.time(
start_location <-foreach(i=1:200,.combine = rbind) %dopar%{
a <- which(trans_alltag_a[i,1] == A2$이비카드정류장ID)
b <- A2[a,9:10]
ifelse(nrow(b)>0,
c <- b,
c <- data.frame(WGS84위도="미등록",WGS84경도="미등록"))
c
})
system.time(
end_location <-foreach(i=1:200,.combine = rbind) %dopar%{
a <- which(trans_alltag_a[i,2] == A2$이비카드정류장ID)
b <- A2[a,9:10]
ifelse(nrow(b)>0,
c <- b,
c <- data.frame(WGS84위도="미등록",WGS84경도="미등록"))
c
})
table_alltag <- cbind(trans_alltag_a,start_location,end_location) %>%
`colnames<-`(c("org","dst","freq","start_lat","start_lon","end_lat","end_lon"))
system.time(
start_location <-foreach(i=1:500,.combine = rbind) %dopar%{
a <- which(trans_alltag_a[i,1] == A2$이비카드정류장ID)
b <- A2[a,9:10]
ifelse(nrow(b)>0,
c <- b,
c <- data.frame(WGS84위도="미등록",WGS84경도="미등록"))
c
})
system.time(
end_location <-foreach(i=1:500,.combine = rbind) %dopar%{
a <- which(trans_alltag_a[i,2] == A2$이비카드정류장ID)
b <- A2[a,9:10]
ifelse(nrow(b)>0,
c <- b,
c <- data.frame(WGS84위도="미등록",WGS84경도="미등록"))
c
})
table_alltag <- cbind(trans_alltag_a,start_location,end_location) %>%
`colnames<-`(c("org","dst","freq","start_lat","start_lon","end_lat","end_lon"))
table_alltag <- table_alltag[!is.na(table_alltag$end_lat),]
table_alltag <- table_alltag[!is.na(table_alltag$start_lat),]
View(table_alltag)
table_alltag <- table_alltag[-table_alltag$start_lat=="미등록",]
table_alltag$start_lat=="미등록"
table_alltag <- table_alltag[!table_alltag$start_lat=="미등록",]
table_alltag <- table_alltag[!table_alltag$end_lat=="미등록",]
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = table_alltag
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
table_alltag <- apply(table_alltag, margin=2, as.numeric)
table_alltag <- apply(table_alltag, margin=2, FUN=as.numeric)
table_alltag <- apply(table_alltag, 2, as.numeric)
str(table_alltag)
table_alltag <- as.data.frame(apply(table_alltag, 2, as.numeric))
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = table_alltag
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
View(A1)
table(A1$X...버스노선ID1...)
a <- table_alltag[1,4:7]
a
(a[1]-a[3])^2
(abs(a[1]-a[3]))^2
(a[1]-a[3])^2+(a[2]-a[4])^2
sqrt((a[1]-a[3])^2+(a[2]-a[4])^2)
View(A2)
table(substr(A1$X...최종하차일시...,9,10))
sum(is.na(A1$X...최종하차일시...))
view(table(substr(A1$X...최종하차일시...,9,10)))
view(prop.table(substr(A1$X...최종하차일시...,9,10)))
mean(A1$X...총이용금액...)
median(A1$X...총이용금액...)
table(substr(A1$X...최종하차일시...,9,10))
write.csv(table(substr(A1$X...최종하차일시...,9,10)),"하차시간대.csv")
write.csv(table(substr(A1$X...최종하차일시...,9,10)),"하차시간대.csv")[2]
table(substr(A1$X...최종하차일시...,9,10))[2]
sum(table(substr(A1$X...최종하차일시...,9,10))[8:9])
#동탄신도시 출발 0702~0704 07~09시
dongtan_tag_aa <- dongtan_tag[substr(dongtan_tag$X...최종하차일시...,8,8)==2|
substr(dongtan_tag$X...최종하차일시...,8,8)==3|
substr(dongtan_tag$X...최종하차일시...,8,8)==4,]
dongtan_tag_aa_morning <- dongtan_tag_aa[substr(dongtan_tag_aa$X...최종하차일시...,9,10)=="07"|
substr(dongtan_tag_aa$X...최종하차일시...,9,10)=="08"|
substr(dongtan_tag_aa$X...최종하차일시...,9,10)=="09",]
#m_down_morning
m_down_morning <- data.frame(table(dongtan_tag_aa_morning$X...최종하차역ID...))
m_down_morning$name <- NA
library(plyr)
library(dplyr)
library(doParallel)
library(tidygraph)
library(ggraph)
library(tidyverse)
library(mapdeck)
key = "pk.eyJ1IjoibHVuYXNlb3JpbSIsImEiOiJjazJjd3A0Z3IwajAzM2RvMjJvNWdqOGM5In0.C8bch4gbQBoRMccrAeCv8Q"
library(arules)
detectCores()
cl <- makeCluster(7)
registerDoParallel(cl)
system.time(
m_down_name <- foreach (i=1:1427,.combine = rbind) %dopar% {
a1 <- which(m_down_morning$Var1[i] == A2$이비카드정류장ID)
ifelse(length(a1)>0,
ifelse(length(A2$정류소명[a1])>0,
m_down_morning$name[i] <- as.character(A2$정류소명[a1]),
m_down_morning$name[i] <- "미등록"),
m_down_morning$name[i] <- "미등록")
}
)
#병렬화 중지
stopCluster(cl)
registerDoParallel(cl)
system.time(
m_down_name <- foreach (i=1:1427,.combine = rbind) %dopar% {
a1 <- which(m_down_morning$Var1[i] == A2$이비카드정류장ID)
ifelse(length(a1)>0,
ifelse(length(A2$정류소명[a1])>0,
m_down_morning$name[i] <- as.character(A2$정류소명[a1]),
m_down_morning$name[i] <- "미등록"),
m_down_morning$name[i] <- "미등록")
}
)
library(plyr)
library(dplyr)
library(doParallel)
library(tidygraph)
library(ggraph)
library(tidyverse)
library(mapdeck)
key = "pk.eyJ1IjoibHVuYXNlb3JpbSIsImEiOiJjazJjd3A0Z3IwajAzM2RvMjJvNWdqOGM5In0.C8bch4gbQBoRMccrAeCv8Q"
library(arules)
detectCores()
cl <- makeCluster(7)
registerDoParallel(cl)
system.time(
m_down_name <- foreach (i=1:1427,.combine = rbind) %dopar% {
a1 <- which(m_down_morning$Var1[i] == A2$이비카드정류장ID)
ifelse(length(a1)>0,
ifelse(length(A2$정류소명[a1])>0,
m_down_morning$name[i] <- as.character(A2$정류소명[a1]),
m_down_morning$name[i] <- "미등록"),
m_down_morning$name[i] <- "미등록")
}
)
m_down_morning$name <- m_down_name
system.time(
m_down_name <- foreach (i=1:1429,.combine = rbind) %dopar% {
a1 <- which(m_down_morning$Var1[i] == A2$이비카드정류장ID)
ifelse(length(a1)>0,
ifelse(length(A2$정류소명[a1])>0,
m_down_morning$name[i] <- as.character(A2$정류소명[a1]),
m_down_morning$name[i] <- "미등록"),
m_down_morning$name[i] <- "미등록")
}
)
m_down_morning$name <- m_down_name
View(m_down_morning)
#m_down_morning
move_total <- dongtan_tag_dst_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
#m_down_morning
move_total <- dongtan_tag_aa_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
View(trans_table)
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
View(A2)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = table_alltag
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
#굴곡도 custom function
d_length <- function(a,b,c,d){
e <- (a-c)^2+(b-c)^2
f <- sqrt(e)
f
}
d_length(37.20403,127.0713,37.22472,127.0742,)
d_length(37.20403,127.0713,37.22472,127.0742)
#굴곡도 custom function
d_length <- function(a,b,c,d){
e <- (a-c)^2+(b-d)^2
f <- sqrt(e)
f
}
d_length(37.20403,127.0713,37.22472,127.0742)
#m_down_morning
move_total <- dongtan_tag_aa_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
sum(trans_table$freq)
sum(trans_table[trans_table$dst=="4197592",3])
sum(trans_table[trans_table$dst=="4197592"|trans_table$dst=="4197593",3])
i
i=1
which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]|
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
#동탄내 이동 태그기록
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
#동탄내 이동 태그기록
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
#동탄내 이동 태그기록
system.time(
dongtan_tag_ext <- foreach (i=1:2,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
c
View(c)
#동탄내 이동 태그기록
dongtan_tag_ext <- data.frame()
for (i in 1:149) {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
dongtan_tag_ext<-rbind(dongtan_tag_ext,c)
cat(i,"/149","\n")
}
View(dongtan_tag_ext)
#동탄신도시 도착 태그기록(dongtan_tag_dst)
system.time(
dongtan_tag_dst <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
library(plyr)
library(dplyr)
library(doParallel)
library(tidygraph)
library(ggraph)
library(tidyverse)
library(mapdeck)
key = "pk.eyJ1IjoibHVuYXNlb3JpbSIsImEiOiJjazJjd3A0Z3IwajAzM2RvMjJvNWdqOGM5In0.C8bch4gbQBoRMccrAeCv8Q"
library(arules)
#병렬화 중지
stopCluster(cl)
detectCores()
cl <- makeCluster(7)
registerDoParallel(cl)
#동탄신도시 도착 태그기록(dongtan_tag_dst)
system.time(
dongtan_tag_dst <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
View(D2)
View(D1)
View(dongtan_stop)
dongtan_tag_dst$X...승차역ID1...
dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[1]
which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[1])
i
which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- dongtan_tag_dst[a,]
a<- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
return(b)
b
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c]
d <- dongtan_tag[c,]
system.time(
dongtan_tag_ext <- foreach (i=1:2,.combine = rbind) %dopar% {
a <- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c,]
rbind(b,d)
}
)
View(dongtan_tag_ext)
#동탄내 이동 태그기록
dongtan_tag_ext <- data.frame()
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
a <- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c,]
rbind(b,d)
}
)
x <- unique(dongtan_tag_ext)
dongtan_tag_ext <- unique(dongtan_tag_ext)
rm(x)
View(dongtan_tag_ext)
view(table(dongtan_tag_ext$X...최종하차역ID...))
#동탄내 이동 태그기록
dongtan_tag_ext <- data.frame()
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
a <- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c,]
e <- rbind(b,d)
unique(e)
}
)
#동탄내 ext_morning
dongtan_tag_ext_aa <- dongtan_tag[substr(dongtan_tag_ext$X...최종하차일시...,8,8)==2|
substr(dongtan_tag_ext$X...최종하차일시...,8,8)==3|
substr(dongtan_tag_ext$X...최종하차일시...,8,8)==4,]
dongtan_tag_ext_morning <- dongtan_tag_ext_aa[substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="07"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="08"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="09",]
View(dongtan_tag_ext_morning)
#동탄내 구간 morning
move_total <- dongtan_tag_ext_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
dongtan_tag_ext_evening <- dongtan_tag_ext_aa[substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="17"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="18"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="19",]
#동탄내 구간 morning
move_total <- dongtan_tag_ext_evening[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
View(A2)
install.packages("geojsonio")
getwd()
geo_sd <- geojsonio::geojson_read("../data/PJT001_h_100m_cell_pop.geojson")
geo_sd <- geojsonio::geojson_read("data/PJT001_h_100m_cell_pop.geojson")
geo_sd <- geojsonio::geojson_read("data/PJT.geojson")
install.packages("geojsonR")
geo_sd <- geojsonR::FROM_GeoJson("data/PJT.geojson")
View(geo_sd)
move_total <- A1[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
View(A2)
move_total <- E1[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
move_total <- E2[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = table_alltag
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
)
geo_sd <- geojsonR::FROM_GeoJson("data/PJT001_moc_link_2018")
rgdal::readOGR("data/PJT001_moc_link_2018")
geo_sd <- geojsonR::FROM_GeoJson("data/PJT001_moc_link_2018.geojson")
View(geo_sd)
move_total <- dongtan_tag_aa_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
order(trans_table$freq,decreasing=T)
rownames(trans_table)
trans_table<-trans_table[order(trans_table$freq,decreasing=T),] %>%
`rownames<-`(1:3949)
finally_we_find <- trans_table[1:2,]
View(finally_we_find)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
, legend = T
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 0 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 15 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
