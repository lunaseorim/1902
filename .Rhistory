move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
View(trans_table)
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
View(A2)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = table_alltag
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
#굴곡도 custom function
d_length <- function(a,b,c,d){
e <- (a-c)^2+(b-c)^2
f <- sqrt(e)
f
}
d_length(37.20403,127.0713,37.22472,127.0742,)
d_length(37.20403,127.0713,37.22472,127.0742)
#굴곡도 custom function
d_length <- function(a,b,c,d){
e <- (a-c)^2+(b-d)^2
f <- sqrt(e)
f
}
d_length(37.20403,127.0713,37.22472,127.0742)
#m_down_morning
move_total <- dongtan_tag_aa_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
sum(trans_table$freq)
sum(trans_table[trans_table$dst=="4197592",3])
sum(trans_table[trans_table$dst=="4197592"|trans_table$dst=="4197593",3])
i
i=1
which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]|
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
#동탄내 이동 태그기록
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
#동탄내 이동 태그기록
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
#동탄내 이동 태그기록
system.time(
dongtan_tag_ext <- foreach (i=1:2,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
c
View(c)
#동탄내 이동 태그기록
dongtan_tag_ext <- data.frame()
for (i in 1:149) {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i]&
A1$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
dongtan_tag_ext<-rbind(dongtan_tag_ext,c)
cat(i,"/149","\n")
}
View(dongtan_tag_ext)
#동탄신도시 도착 태그기록(dongtan_tag_dst)
system.time(
dongtan_tag_dst <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
library(plyr)
library(dplyr)
library(doParallel)
library(tidygraph)
library(ggraph)
library(tidyverse)
library(mapdeck)
key = "pk.eyJ1IjoibHVuYXNlb3JpbSIsImEiOiJjazJjd3A0Z3IwajAzM2RvMjJvNWdqOGM5In0.C8bch4gbQBoRMccrAeCv8Q"
library(arules)
#병렬화 중지
stopCluster(cl)
detectCores()
cl <- makeCluster(7)
registerDoParallel(cl)
#동탄신도시 도착 태그기록(dongtan_tag_dst)
system.time(
dongtan_tag_dst <- foreach (i=1:149,.combine = rbind) %dopar% {
b <- which(A1$X...최종하차역ID...==dongtan_stop$이비카드정류장ID[i])
c <- A1[b,]
return(c)
}
)
View(D2)
View(D1)
View(dongtan_stop)
dongtan_tag_dst$X...승차역ID1...
dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[1]
which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[1])
i
which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
c <- dongtan_tag_dst[a,]
a<- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
return(b)
b
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c]
d <- dongtan_tag[c,]
system.time(
dongtan_tag_ext <- foreach (i=1:2,.combine = rbind) %dopar% {
a <- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c,]
rbind(b,d)
}
)
View(dongtan_tag_ext)
#동탄내 이동 태그기록
dongtan_tag_ext <- data.frame()
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
a <- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c,]
rbind(b,d)
}
)
x <- unique(dongtan_tag_ext)
dongtan_tag_ext <- unique(dongtan_tag_ext)
rm(x)
View(dongtan_tag_ext)
view(table(dongtan_tag_ext$X...최종하차역ID...))
#동탄내 이동 태그기록
dongtan_tag_ext <- data.frame()
system.time(
dongtan_tag_ext <- foreach (i=1:149,.combine = rbind) %dopar% {
a <- which(dongtan_tag_dst$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
b <- dongtan_tag_dst[a,]
c <- which(dongtan_tag$X...승차역ID1...==dongtan_stop$이비카드정류장ID[i])
d <- dongtan_tag[c,]
e <- rbind(b,d)
unique(e)
}
)
#동탄내 ext_morning
dongtan_tag_ext_aa <- dongtan_tag[substr(dongtan_tag_ext$X...최종하차일시...,8,8)==2|
substr(dongtan_tag_ext$X...최종하차일시...,8,8)==3|
substr(dongtan_tag_ext$X...최종하차일시...,8,8)==4,]
dongtan_tag_ext_morning <- dongtan_tag_ext_aa[substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="07"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="08"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="09",]
View(dongtan_tag_ext_morning)
#동탄내 구간 morning
move_total <- dongtan_tag_ext_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
dongtan_tag_ext_evening <- dongtan_tag_ext_aa[substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="17"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="18"|
substr(dongtan_tag_ext_aa$X...최종하차일시...,9,10)=="19",]
#동탄내 구간 morning
move_total <- dongtan_tag_ext_evening[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
View(A2)
install.packages("geojsonio")
getwd()
geo_sd <- geojsonio::geojson_read("../data/PJT001_h_100m_cell_pop.geojson")
geo_sd <- geojsonio::geojson_read("data/PJT001_h_100m_cell_pop.geojson")
geo_sd <- geojsonio::geojson_read("data/PJT.geojson")
install.packages("geojsonR")
geo_sd <- geojsonR::FROM_GeoJson("data/PJT.geojson")
View(geo_sd)
move_total <- A1[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
View(A2)
move_total <- E1[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
move_total <- E2[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = table_alltag
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
)
geo_sd <- geojsonR::FROM_GeoJson("data/PJT001_moc_link_2018")
rgdal::readOGR("data/PJT001_moc_link_2018")
geo_sd <- geojsonR::FROM_GeoJson("data/PJT001_moc_link_2018.geojson")
View(geo_sd)
move_total <- dongtan_tag_aa_morning[,c(37,48)] %>%
`colnames<-`(c("org","dst"))
move_total<-move_total[nchar(move_total$org)>6&nchar(move_total$dst)>6,]
move_total <- paste0(move_total$org,",",move_total$dst)
trans_table<-as.data.frame(table(move_total))
trans_table <- data.frame(org = substr(trans_table$move_total,1,7),
dst = substr(trans_table$move_total,9,15),
freq = trans_table$Freq)
View(trans_table)
order(trans_table$freq,decreasing=T)
rownames(trans_table)
trans_table<-trans_table[order(trans_table$freq,decreasing=T),] %>%
`rownames<-`(1:3949)
finally_we_find <- trans_table[1:2,]
View(finally_we_find)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 1
, legend = T
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 25 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 45 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 0 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
mapdeck( token = key, style = mapdeck_style("dark"), pitch = 15 ) %>%
add_arc(
data = t_t_fine
, layer_id = "arc_layer"
, origin = c("start_lon", "start_lat")
, destination = c("end_lon", "end_lat")
, stroke_from = "org"
, stroke_to = "dst"
, stroke_width = 3
)
install.packages("survminer")
install.packages("caret")
library(caret)
library(plyr)
library(dplyr)
library(ggplot2)
library(survival)
library(survminer)
library(caret)
library(plyr)
library(dplyr)
library(ggplot2)
library(survival)
library(survminer)
library(caret)
dat<-lung %>%
na.omit() %>%
data.frame()
dat<-lung %>%
na.omit() %>%
data.frame()
pcox_fine <- coxph(Surv(time,status==2)~.,data = dat)
rm(pcox_fine)
str(dat)
Surv(time,status==2)
sample(1:nrow(dat))
length(number)%in%1
sample(nrow(dat),nrow(dat)/3)
167/13
167/17
167/14
167/15
167/16
167/19
1q<-sample(nrow(dat),nrow(dat))[1:55]
2q<-sample(nrow(dat),nrow(dat))[56:110]
1q<-sample(1:nrow(dat))[1:55]
sample(1:nrow(dat))[1:55]
q1<-sample(1:nrow(dat))[1:55]
q1<-sample(1:nrow(dat))[1:55]
q2<-sample(nrow(dat),nrow(dat))[56:110]
q3<-sample(nrow(dat),nrow(dat))[110:167]
q3<-sample(nrow(dat),nrow(dat))[111:167]
unique(q1,q2)
unique(q1,q2,q3)
q2<-sample(nrow(dat),nrow(dat))[56:111]
q3<-sample(nrow(dat),nrow(dat))[112:167]
q1
q2
q3
dat[q1]
dat[q1,]
q1<-dat[sample(1:nrow(dat))[1:55],]
q1<-dat[sample(1:nrow(dat))[1:55],]q2<-sample(nrow(dat),nrow(dat))[56:111]
q1<-dat[sample(1:nrow(dat))[1:55],]
q2<-dat[sample(1:nrow(dat))[56:111],]
q3<-dat[sample(1:nrow(dat))[112:167],]
q1<-dat[sample(nrow(dat))[1:55],]
q1
View(q1)
View(q2)
View(q3)
train1 <- rbind(q1,q2)
coxph(Surv(time,status==2)~,data = train1)
str(dat)
i=age
i="age"
coxph(Surv(time,status==2)~i,data = train1)
i="train1$age"
i=train1$age
coxph(Surv(time,status==2)~i,data = train1)
i="age"
coxph(Surv(time,status==2)~cat(i),data = train1)
View(dat)
i=4
coxph(Surv(time,status==2)~train[,i],data = train1)
coxph(Surv(time,status==2)~train1[,i],data = train1)
View(dat)
for (i in 4:10) {
coxph(Surv(time,status==2)~train1[,i],data = train1)
}
for (i in 4:10) {
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
print(a)
}
for (i in 4:10) {
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
summary(a)
}
for (i in 4:10) {
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
print(summary(a))
}
print(summary(a$score))
print(summary(a$loglik))
print(summary(a$iter))
print(summary(a$method))
print(summary(a$call))
print(summary(a$formula))
print(summary(a$concordance))
print(summary(a$wald.test))
print(summary(a)$wald.test)
print(a$wald.test)
coxph(Surv(time,status==2)~train1[,i],data = train1)
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
print(a$wald.test)
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
a
print(a$wald.test)
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
print(a$wald.test)
a
print(a$method)
print(a$terms)
print(a$residuals)
print(a$iter)
print(a$nevent)
print(a$y)
print(a$terms)
print(a$
)
print(a$linear.predictors)
print(a$var)
print(a$y)
print(a$concordance)
print(a$concordance)
print(a$assign)
print(a$assign$`train1[, i]`)
for (i in 4:10) {
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
print(summary(a))
}
colnames(train1)[i]
for (i in 4:10) {
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
print(colnames(train1)[i])
print(summary(a))
}
a$wald.test
for (i in 4:10) {
a <- coxph(Surv(time,status==2)~train1[,i],data = train1)
print(colnames(train1)[i])
print(summary(a))
}
for (i in c(4,6:10)) {
a <- coxph(Surv(time,status==2)~sex+train1[,i],data = train1)
print(colnames(train1)[i])
print(summary(a))
}
for (i in c(4,6:10)) {
a <- coxph(Surv(time,status==2)~sex+train1[,i],data = train1)
print(paste("i=",colnames(train1)[i]))
print(summary(a))
}
for (i in c(4,6:10)) {
a <- coxph(Surv(time,status==2)~sex+train1[,i],data = train1)
print(paste0("i=",colnames(train1)[i]))
print(summary(a))
}
for (i in c(4,6,7,9,10)) {
a <- coxph(Surv(time,status==2)~sex+pat.karno+train1[,i],data = train1)
print(paste0("i=",colnames(train1)[i]))
print(summary(a))
}
step(pcox_fine,direction = "forward",trace = 0)
pcox_fine <- coxph(Surv(time,status==2)~.,data = dat)
step(pcox_fine,direction = "forward",trace = 0)
pcox_fine <- coxph(Surv(time,status==2)~.,data = dat)
summary(pcox_fine)
pcox_fine <- coxph(Surv(time,status==2)~.-inst,data = dat)
summary(pcox_fine)
pcox_step <-step(pcox_fine,direction = "forward",trace = 0)
pcox_step
ggforest(pcox_step,data = dat)
pcox_fine <- coxph(Surv(time,status==2)~.-inst,data = dat)
summary(pcox_fine)
pcox_step <-step(pcox_fine,direction = "forward",trace = 0)
pcox_step
ggforest(pcox_step,data = dat)
cox.zph(pcox_step)
